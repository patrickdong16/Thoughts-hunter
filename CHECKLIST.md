# 思想雷达 - 联调检查清单

完整的系统测试和验证清单。

## 🚀 部署前检查

### 环境配置

- [ ] 后端 `.env` 文件已配置
- [ ] CMS `.env` 文件已配置  
- [ ] 移动端 `.env` 文件已配置（如果真机测试）
- [ ] 所有敏感信息已移除（不要提交到Git）

---

## 🔧 后端检查

### 基础功能

- [ ] PostgreSQL 数据库运行正常
- [ ] 数据库连接测试通过
- [ ] 数据库已初始化 (`npm run init-db`)
- [ ] 后端服务启动成功 (`npm run dev`)
- [ ] 访问 http://localhost:3000/health 返回成功

### API端点测试

**系统端点**
- [ ] GET `/health` - 健康检查
- [ ] GET `/` - API文档

**雷达数据**
- [ ] GET `/api/radar/today` - 获取今日雷达
- [ ] GET `/api/radar/2026-01-19` - 获取指定日期
- [ ] GET `/api/radar/item/1` - 获取单条详情
- [ ] GET `/api/radar/all/grouped` - 获取分组数据
- [ ] POST `/api/radar` - 创建新条目
- [ ] PUT `/api/radar/1` - 更新条目
- [ ] DELETE `/api/radar/1` - 删除条目

**频段管理**
- [ ] GET `/api/bands` - 获取所有频段
- [ ] GET `/api/bands/T1` - 获取单个频段
- [ ] PUT `/api/bands/T1/tti` - 更新TTI值

**用户行为**
- [ ] POST `/api/user/like` - 收藏功能
- [ ] POST `/api/user/stance` - 立场记录
- [ ] GET `/api/user/test_user/likes` - 收藏列表
- [ ] GET `/api/user/test_user/stances` - 立场列表

### CORS配置

- [ ] CMS域名已添加到CORS白名单
- [ ] 移动端可以跨域访问
- [ ] 浏览器控制台无CORS错误

### 数据验证

- [ ] 正文长度验证（≥700字）
- [ ] 立场验证（仅A或B）
- [ ] 日期格式验证
- [ ] 频段ID验证
- [ ] 唯一性约束（同日同频段）

---

## 💻 CMS检查

### 基础功能

- [ ] CMS 服务启动成功 (`npm run dev`)
- [ ] 访问 http://localhost:5173 正常
- [ ] API连接成功（无"加载失败"错误）

### 内容管理

**查看功能**
- [ ] 能看到今日雷达列表
- [ ] 按日期分组显示正确
- [ ] 每日条目数量统计准确
- [ ] 达标状态提示正确（6-8条绿色✓）

**添加功能**
- [ ] 点击"添加内容"打开表单
- [ ] 所有字段显示正常
- [ ] 频段下拉菜单工作正常
- [ ] 立场选择（A/B）工作正常
- [ ] 字数统计实时更新
- [ ] 小于700字时显示提示
- [ ] 今日数量提示显示正确
- [ ] 本周频段覆盖检查工作
- [ ] 点击"创建"成功保存
- [ ] 保存后列表自动刷新

**编辑功能**
- [ ] 点击"编辑"打开表单
- [ ] 现有数据自动填充
- [ ] 修改后能成功保存
- [ ] 保存后列表自动更新

**删除功能**
- [ ] 点击"删除"显示确认对话框
- [ ] 确认后成功删除
- [ ] 删除后列表自动刷新

### 频段管理

- [ ] 切换到"频段管理"Tab正常
- [ ] 显示所有18个频段
- [ ] 按领域分组正确
- [ ] TTI值显示正确
- [ ] TTI颜色编码正确（绿/橙/红）
- [ ] 点击"编辑"可以修改TTI
- [ ] 输入验证（0-100）工作
- [ ] 保存后立即更新显示

### 界面元素

- [ ] 暗色主题正确应用
- [ ] 绿色主色调 (#00ff88)
- [ ] 徽章颜色正确
- [ ] 按钮悬停效果正常
- [ ] 响应式布局正常（缩放浏览器测试）

---

## 📱 移动端APP检查

### 基础功能

- [ ] Expo 启动成功 (`npx expo start`)
- [ ] iOS模拟器运行正常（按 i）
- [ ] Android模拟器运行正常（按 a）
- [ ] 真机扫码可以运行

### 今日雷达页面

**显示功能**
- [ ] 顶部Logo和标题显示正常
- [ ] 当前日期显示正确
- [ ] 领域筛选器显示正确
- [ ] 卡片列表渲染正常
- [ ] 能看到今日所有条目

**筛选功能**
- [ ] "全部"显示所有内容
- [ ] "科技"只显示科技内容
- [ ] "政治"只显示政治内容
- [ ] "历史"只显示历史内容
- [ ] "哲学"只显示哲学内容
- [ ] "宗教"只显示宗教内容
- [ ] "金融"只显示金融内容

**卡片功能**
- [ ] 频段标签显示正确（如T1）
- [ ] 立场标签颜色正确（A蓝/B橙）
- [ ] 标题显示完整
- [ ] 作者头像和姓名显示
- [ ] 作者简介显示
- [ ] 出处绿色边框样式正确
- [ ] 正文内容显示（前200字）
- [ ] 点击"展开全文"显示完整内容
- [ ] 点击"收起"折叠内容
- [ ] 张力信息显示正确
- [ ] AB两极对比显示

**交互功能**
- [ ] 收藏按钮点击工作
- [ ] 收藏后❤️变红色
- [ ] 取消收藏后变回🤍
- [ ] "我倾向A"按钮点击工作
- [ ] "我倾向B"按钮点击工作
- [ ] 选中后按钮高亮显示
- [ ] 再次点击可以取消选择

**刷新功能**
- [x] ~~下拉刷新手势~~ (已取消)
- [ ] 刷新时显示加载动画
- [ ] 刷新后数据更新

**离线功能**
- [ ] 首次加载后关闭WiFi
- [ ] 仍能查看缓存的内容
- [ ] 显示合适的提示信息

### 张力指数页面

- [ ] 切换到"张力"Tab正常
- [ ] 显示所有18个频段
- [ ] 按领域分组显示
- [ ] 频段ID显示正确（T1, P1等）
- [ ] 核心问题显示完整
- [ ] TTI数值显示正确
- [ ] TTI颜色编码正确
- [ ] 光谱条渐变正确（蓝到橙）
- [ ] 光谱条宽度按TTI值显示
- [ ] AB两极描述显示完整

### 历史记录页面

- [ ] 切换到"历史"Tab正常
- [ ] 显示最近7天日期
- [ ] 日期按钮可以点击
- [ ] 选中日期后加载该日内容
- [ ] 显示该日条目数量
- [ ] 卡片显示正常（同今日页面）
- [ ] 空日期显示提示信息

### 个人中心页面

**收藏Tab**
- [ ] 切换到"我的"Tab正常
- [ ] 默认显示"我的收藏"
- [ ] 显示收藏数量
- [ ] 列表显示所有收藏内容
- [ ] 卡片显示正常
- [ ] 可以取消收藏
- [x] ~~下拉刷新~~ (已取消)

**立场Tab**
- [ ] 切换到"我的立场"
- [ ] 显示立场数量
- [ ] 列表显示所有立场记录
- [ ] 显示选择的立场（A或B）
- [ ] 卡片显示正常
- [ ] 可以修改立场
- [x] ~~下拉刷新~~ (已取消)

**空状态**
- [ ] 无收藏时显示提示
- [ ] 无立场时显示提示
- [ ] 提示文本友好清晰

### 性能检查

- [ ] 列表滚动流畅
- [ ] 卡片加载无卡顿
- [ ] 图片（如有）加载正常
- [ ] Tab切换流畅
- [ ] 无明显内存泄漏

### 界面检查

- [ ] 暗色主题正确应用
- [ ] 背景颜色#08090c
- [ ] 主色#00ff88显示正确
- [ ] A极蓝色#4a9eff
- [ ] B极琥珀色#f0a500
- [ ] 字体大小适中易读
- [ ] 间距合理舒适

---

## 🔄 数据流检查

### CMS → 后端 → APP

**测试流程：**

1. **在CMS添加新内容**
   - [ ] 在CMS添加一条今日内容
   - [ ] 填写完整信息（标题、作者、正文等）
   - [ ] 点击"创建"

2. **后端存储**
   - [ ] 后端成功接收请求
   - [ ] 数据成功存入PostgreSQL
   - [ ] 返回成功响应

3. **APP获取显示**
   - [x] ~~在APP下拉刷新~~ (已取消)
   - [ ] 新内容出现在列表中
   - [ ] 所有信息显示正确
   - [ ] 格式和样式正确

### APP → 后端 → CMS

**测试收藏：**

1. **在APP收藏内容**
   - [ ] 点击某条内容的❤️
   - [ ] 按钮变红表示收藏

2. **后端记录**
   - [ ] 后端收到收藏请求
   - [ ] user_actions表添加记录

3. **CMS无需显示**（当前版本）
   - [ ] 但数据已正确保存

**测试立场：**

1. **在APP选择立场**
   - [ ] 点击"我倾向A"或"我倾向B"
   - [ ] 按钮高亮显示

2. **后端记录**
   - [ ] 后端收到立场请求
   - [ ] user_actions表添加/更新记录

3. **个人中心查看**
   - [ ] 切换到"我的">"我的立场"
   - [ ] 能看到刚才的选择

---

## 🔒 安全检查

### 后端安全

- [ ] 敏感信息不在代码中硬编码
- [ ] `.env` 文件在 `.gitignore` 中
- [ ] DATABASE_URL 不会暴露
- [ ] API有基本的错误处理
- [ ] SQL注入防护（使用参数化查询）

### 前端安全

- [ ] API密钥不在前端代码中
- [ ] CORS配置合理（不是*）
- [ ] 用户输入有验证

---

## 📊 性能检查

### 后端性能

- [ ] 数据库查询使用索引
- [ ] 连接池配置合理
- [ ] API响应时间< 500ms

### CMS性能

- [ ] 首屏加载< 3秒
- [ ] 列表渲染流畅
- [ ] 表单提交响应及时

### APP性能

- [ ] 首屏加载< 3秒
- [ ] 列表滚动60fps
- [ ] 缓存机制工作正常
- [ ] 离线可用

---

## 🐛 错误处理检查

### 网络错误

- [ ] 后端停止时CMS显示友好错误
- [ ] 后端停止时APP读取缓存
- [ ] 请求超时有提示

### 数据错误

- [ ] 字数不足500有提示
- [ ] 重复日期+频段有提示
- [ ] 必填字段缺失有提示
- [ ] TTI超出范围有提示

### 界面错误

- [ ] 空列表显示友好提示
- [ ] 加载中有动画
- [ ] 404页面友好

---

## ✅ 最终验收

### 完整流程测试

1. **内容管理员工作流**
   - [ ] 打开CMS
   - [ ] 添加今日6-8条内容
   - [ ] 覆盖不同频段
   - [ ] 调整频段TTI

2. **用户使用流程**
   - [ ] 打开APP
   - [ ] 查看今日雷达
   - [ ] 阅读感兴趣的内容
   - [ ] 收藏喜欢的内容
   - [ ] 表达自己的立场
   - [ ] 查看历史内容
   - [ ] 在个人中心回顾

3. **系统稳定性**
   - [ ] 连续使用30分钟无崩溃
   - [ ] 来回切换无问题
   - [ ] 多次刷新正常

---

## 📱 设备兼容性（移动端）

### iOS
- [ ] iOS 13+ 正常运行
- [ ] iPhone SE（小屏）显示正常
- [ ] iPhone 14 Pro（大屏）显示正常
- [ ] iPad（如果支持）显示正常

### Android
- [ ] Android 10+ 正常运行
- [ ] 小屏设备显示正常
- [ ] 大屏设备显示正常
- [ ] 不同分辨率适配正常

---

## 🎉 完成标准

所有检查项都打✅后，系统即可认为：

✅ **开发完成**  
✅ **测试通过**  
✅ **准备部署**  

---

## 📝 问题记录

如果发现问题，记录在这里：

### 问题1
- **现象**: 
- **原因**: 
- **解决**: 
- **状态**: 

### 问题2
- **现象**: 
- **原因**: 
- **解决**: 
- **状态**: 

---

**检查人**: ___________  
**检查日期**: ___________  
**通过率**: _____ / _____ 项  
**是否通过**: ☐ 是  ☐ 否  
