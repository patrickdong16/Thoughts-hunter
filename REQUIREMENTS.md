# 思想雷达 - 需求规格书

> **版本**：v4.2  
> **更新日期**：2026-01-28  
> **状态**：✅ 已确认  
> **规则**：所有需求变更必须先更新本文件

---

## 一、产品定义

### 1.1 产品本质

思想雷达**不是**信息聚合工具，**不是**观点推荐系统。

它是一个**认知基础设施**，用于回答：
- 哪些变化是**噪音**，哪些是**结构性转折**？
- 不同学科的思想，如何在**同一时代压力下**形成对抗？
- 用哪些**长期问题坐标系**（而非热点）来校准判断？

### 1.2 核心目标

> 在文明不稳定期，持续追踪**哪些结构正在断裂、哪些价值正在被重估、哪些方向仍值得长期押注**

### 1.3 目标用户

高认知密度用户 / 科技投资人 / 长期判断者

---

## 二、设计原则

### 2.1 六大知识领域

| 领域 | 判断什么 |
|------|----------|
| 技术 | 人类是否正在失控 |
| 政治 | 为什么还要服从 |
| 历史 | 我们是不是走在老路上 |
| 哲学 | 价值冲突如何取舍 |
| 宗教 | 秩序最后靠什么维持 |
| 金融 | 未来是否仍被相信 |

### 2.2 时代级问题标准（三不可）

| 原则 | 说明 |
|------|------|
| **不可兼得** | A/B 必然冲突 |
| **不可回避** | 现实每天都在逼迫回答 |
| **不可轻易解决** | 至少 10-20 年有效 |

---

## 三、频段系统（19 个）

### 3.1 技术 (T) - 3 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| T1 | AI 是否正在重写社会分层？ | 普惠化，能力上移 | 精英化，阶层断裂 |
| T2 | 技术是嵌入制度还是绕开制度？ | 可被制度吸收 | 天然反制度 |
| T3 | 技术是否已脱离人类集体意志？ | 仍可被伦理引导 | 已成竞争宿命 |

### 3.2 政治 (P) - 3 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| P1 | 民主是否已不适应高复杂度社会？ | 低效但不可替代 | 技术官僚更现实 |
| P2 | 权力是否正在脱离公共可见性？ | 仍可拉回公共领域 | 已进入后政治治理 |
| P3 | 自由社会能否对抗反自由力量？ | 有自我修复能力 | 正被系统性削弱 |

### 3.3 历史 (H) - 3 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| H1 | 历史是否正在重演？ | 周期可被打破 | 规律不可抗拒 |
| H2 | 文明冲突是否主导世界？ | 可对话融合 | 冲突是必然 |
| H3 | 帝国是否正在回归？ | 多极秩序可稳定 | 新帝国正在形成 |

### 3.4 哲学 (Φ) - 4 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| Φ1 | 自由意志是否仍然存在？ | 人类保有选择能力 | 自由意志是幻觉 |
| Φ2 | 意识能否被技术复制？ | 有不可还原性 | 可被计算模拟 |
| Φ3 | AI 是否会拥有道德地位？ | AI 只是工具 | 可能成为道德主体 |
| Φ4 | 价值是主观还是客观的？ | 存在普世价值 | 完全是建构的 |

### 3.5 宗教 (R) - 3 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| R1 | 宗教是否仍能提供意义？ | 不可替代的意义来源 | 世俗化不可逆转 |
| R2 | 科学与信仰能否共存？ | 各有领域 | 科学终将取代信仰 |
| R3 | 技术是否正在成为新宗教？ | 技术崇拜是暂时的 | 技术乌托邦正在兴起 |

### 3.6 金融 (F) - 3 个

| 频段 | 核心问题 | A 极 | B 极 |
|------|----------|------|------|
| F1 | 加密货币是否会重塑金融秩序？ | 是泡沫 | 去中心化是未来 |
| F2 | UBI 是否必要？ | 市场仍能解决就业 | AI 将导致大规模失业 |
| F3 | ESG 是否只是营销？ | 是真实的价值转向 | 是资本的伪装 |

---

## 四、内容来源体系

### 4.1 文字来源

**A. 权威与共识的筛选机制**
- 各国权威榜单/奖项
- 权威媒体深度栏目
- 高质量出版社与机构推荐
- 非虚构为主，强调严肃性、人文性与论证结构

**B. 顶级头脑的原始表达（当代与历史）**
- 书籍（作者本人作品优先）
- 深度文章与长评论（NYT、FT、Foreign Affairs 等）

### 4.2 视频来源

- YouTube 频道
- 长访谈 / 演讲 / 播客

> 详细来源清单见 [CONTENT_SOURCES.md](./CONTENT_SOURCES.md)

### 4.3 信息提炼要求

1. 对现实有**解释力**、能进入命题对照的思想材料
2. 不仅是"新闻事实"，而是对事实背后的**结构解释、理论框架与价值冲突**的表达

### 4.4 思想领袖主动追踪系统 🆕

> **状态**：✅ 已实现 (2026-01-27)

#### 4.4.1 功能目标

主动追踪高影响力思想领袖的最新发布，确保重要观点不被遗漏。

**核心逻辑**：追踪正确的人 > 搜索正确的关键词

#### 4.4.2 数据表设计

| 表名 | 用途 |
|------|------|
| `thought_leaders` | 思想领袖信息（姓名、领域、优先级、RSS/博客/Twitter） |
| `leader_content_log` | 内容追踪日志（URL、发现时间、是否已收录） |

#### 4.4.3 优先级规则

| 级别 | 说明 | 处理方式 |
|------|------|----------|
| priority=1 | 核心领袖（Dario Amodei, Sam Altman 等） | 发文即当日必收 |
| priority=2 | 高优先级（Demis Hassabis, Yuval Harari 等） | 优先处理 |
| priority≥3 | 普通优先级 | 按日期排序 |

#### 4.4.4 初始追踪名单

详见 [CONTENT_SOURCES.md](./CONTENT_SOURCES.md) 第二章「核心人物」

#### 4.4.5 API 端点

| 端点 | 方法 | 用途 |
|------|------|------|
| `/api/automation/leaders` | GET | 获取思想领袖列表 |
| `/api/automation/leaders` | POST | 添加新领袖 |
| `/api/automation/leaders/check` | POST | 触发 RSS 采集 |
| `/api/automation/leaders/pending` | GET | 获取待处理的高优先级内容 |

#### 4.4.6 每日执行顺序

```
1. leaders/check → 扫描领袖新发布
2. leaders/pending → 获取待处理文章
3. 多源搜索 → RSS/HN/arXiv/YouTube
4. 质检 → 字数/URL/频段匹配
5. 发布 → POST /api/radar
```

---

### 4.5 内容生成 v2.0 框架 🆕

> **状态**：✅ 已实现 (2026-01-27)  
> **核心理念**：以人为本 — 思想跟踪体系驱动，非平台驱动

#### 4.5.1 采集优先级体系

```
┌────────────────────────────────────────────────────────────┐
│  P0（最高优先级）                                           │
│  思想跟踪体系内名单 → 扫描其 RSS/博客/Google 言论             │
│  目标：抓取跟踪名单内人物的最新热点观点                        │
└────────────────────────────────────────────────────────────┘
                            ↓
┌────────────────────────────────────────────────────────────┐
│  P1（补充层）                                               │
│  同级别思想者（不在名单内）→ 扫描 RSS/博客/Google            │
│  标准：必须是与跟踪名单同级别的权威人物                        │
└────────────────────────────────────────────────────────────┘
                            ↓
┌────────────────────────────────────────────────────────────┐
│  P2（视频层）                                               │
│  YouTube 优质视频 → 优先跟踪名单频道                         │
│  目标：视频形式的高质量内容补充                               │
└────────────────────────────────────────────────────────────┘
```

| 优先级 | 来源类型 | 说明 | 渠道 |
|--------|----------|------|------|
| **P0** | 跟踪名单内人物 | 核心思想领袖 | RSS/博客/Google |
| **P1** | 同级别思想者 | 未入库的权威人物 | RSS/博客/Google |
| **P2** | YouTube 视频 | 补充视频内容 | 跟踪频道优先 |

#### 4.5.2 普通日 vs 主题日规则

**普通日（🔵 Regular Day）**

| 配额项 | 要求 | 说明 |
|--------|------|------|
| 总数量 | 6-8 条 | 基础配额 |
| 非视频 | **5-7 条** | RSS/博客为主（强制） |
| 视频 | **≥1 条** | YouTube 补充（强制） |
| 频段覆盖 | **各核心频段≥1** | T1/P1/H1/Φ1/F1/R1 各至少 1 条 |

**主题日（🔴 Theme Day，如达沃斯、慕安会）**

| 配额项 | 要求 | 说明 |
|--------|------|------|
| 总数量 | 10-20 条 | 按活动规模配置 |
| 内容类型 | **不限** | 视频/非视频均可 |
| 频段覆盖 | **尽量涉猎** | 不强制各频段都有 |
| 主题聚焦 | **100%** | 只收录主题活动内容 |

#### 4.5.3 配置文件 (`day-config.json`)

```json
{
  "regularDay": {
    "minItems": 6, "maxItems": 8,
    "minNonVideoItems": 5, "maxNonVideoItems": 7,
    "minVideoItems": 1,
    "minPerFrequency": 1,
    "contentTypeFlex": false,
    "frequencyFlex": false
  },
  "themeDay": {
    "minItems": 10, "maxItems": 20,
    "contentTypeFlex": true,
    "frequencyFlex": true
  }
}
```

#### 4.5.4 每日执行流程 v3.0 🔄

> ⚠️ **2026-01-28 更新**：统一入口，配置驱动

```
推荐流程（一键执行）:
Step 1 → POST /api/automation/daily-radar  # RSS 优先 + 频段平衡
Step 2 → 配额检查 + 视频补充（如需）
Step 3 → 最终验证

详细流程（见 §4.5.7 配置驱动架构）
```

> **配置中心**：`CONTENT_SOURCES.json` (35 RSS 源 + 27 YouTube 频道)

#### 4.5.6 P2 视频扫描机制 🆕

> **状态**：✅ 已实现 (2026-01-27)

##### 扫描架构

```
┌─────────────────────────────────────────────┐
│  /api/automation/scan-channels              │
│  优先 YouTube API，失败自动切换 RSS         │
└─────────────────────────────────────────────┘
                     ↓
┌─────────────────────────────────────────────┐
│  YouTube API 扫描 (10,000 单位/日配额)      │
│  - search.list = 100 单位/频道              │
│  - videos.list = 1 单位/视频详情            │
└─────────────────────────────────────────────┘
        ↓ 失败/配额用完             ↓ 成功
┌───────────────────────┐   ┌─────────────────┐
│  RSS Fallback         │   │  视频详情获取    │
│  - 无配额消耗扫描     │   │  (时长筛选)      │
│  - 每频道最新 15 视频  │   └─────────────────┘
└───────────────────────┘           ↓
        ↓                   ┌─────────────────┐
┌───────────────────────┐   │  添加到队列      │
│  时长检查 (API)       │   │  (≥40 分钟)     │
│  1 单位/视频          │   └─────────────────┘
└───────────────────────┘
```

##### 配额消耗对比

| 方式 | 扫描 27 频道消耗 | 说明 |
|------|------------------|------|
| 纯 YouTube API | ~2,700 单位 | search 100 单位/频道 |
| RSS + 时长检查 | ~135 单位 | 仅视频详情消耗配额 |

##### 核心函数 (`video-scanner.js`)

| 函数 | 说明 |
|------|------|
| `scanAllChannels()` | YouTube API 扫描所有配置频道 |
| `scanChannelViaRSS()` | 通过 RSS Feed 扫描单个频道 |
| `scanAllChannelsViaRSS()` | 批量 RSS 扫描（仅 UC 格式频道） |
| `scanWithFallback()` | 智能切换：API 优先，失败用 RSS |
| `addToQueue()` | 添加到 `collection_log` 表 |

##### API 端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/automation/scan-channels` | POST | 扫描频道（自动 fallback） |
| `/api/automation/process-video-queue` | POST | 处理队列中的视频 |
| `/api/automation/search-speaker` | GET | 搜索特定人物视频 |

##### 频道配置 (`automation.js`)

- 位置：`backend/config/automation.js` → `targetChannels`
- 频道 ID 格式：**必须为 UC 开头**（如 `UCSHZKyawb77ixDdsGog4iWA`）
- 当前配置：27 个高质量频道（技术/政治/哲学/金融/宗教）

##### Workflow 集成

```yaml
# .github/workflows/daily-update.yml - P2 步骤
- name: P2 - Scan channels and collect videos
  run: |
    # Step 1: 扫描频道填充队列
    curl -X POST .../scan-channels -d '{"maxVideosPerChannel": 3, "daysBack": 7}'
    
    # Step 2: 处理队列生成内容
    curl -X POST .../process-video-queue
```

#### 4.5.7 配置驱动内容架构 v3.0 🆕

> **状态**：✅ 已实现 (2026-01-28)

##### 核心原则

1. **配置驱动**：`CONTENT_SOURCES.json` 作为唯一信息源配置中心
2. **优先级策略**：非视频 RSS 优先，视频 YouTube 优先
3. **自动生效**：修改配置文件即自动应用到内容生产管道

##### 配置架构

```
CONTENT_SOURCES.json (v2.0)
    │
    ├── rssFeeds (35 源)
    │   ├── tier1: 知识枢纽 (Arts & Letters Daily, The Browser, Project Syndicate)
    │   ├── tier2_*: 领域深耕 (政治/哲学/历史/金融/宗教/文化/经济)
    │   └── tier3_substack: 思想权威 (Niall Ferguson, Slavoj Žižek, Paul Krugman...)
    │
    └── youtubeChannels (27 频道)
```

##### 优先级策略

| 内容类型 | 优先级顺序 |
|----------|------------|
| 非视频 | Tier1 RSS → Tier2 RSS → Tier3 Substack → Leader RSS → Google Search |
| 视频 | YouTube 频道扫描 → YouTube 搜索 |

##### 核心服务

| 文件 | 功能 |
|------|------|
| `content-radar.js` | 统一每日扫描入口，配置加载 |
| `tiered-rss-fetcher.js` | 分层 RSS 抓取，按优先级排序 |
| `multi-source-generator.js` | 配额计算，搜索查询生成 |

##### 统一入口 API

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/automation/daily-radar` | POST | 统一入口（RSS 优先 + 频段平衡） |

> 视频扫描端点详见 §4.5.6

#### 4.5.8 v5.1 双池管道架构 🆕

> **状态**：✅ 已实现 (2026-01-28)

##### 核心概念

```
┌─────────────────────────────────────────────────────────────┐
│  Phase 1: 多源采集                                          │
│  Google News + RSS 扫描 → leads_pool (候选池)               │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 2: AI分析 + 深挖                                     │
│  leads_pool → AI分析 → content_reservoir (储备池)          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 3: 配额发布                                          │
│  content_reservoir → radar_items (发布表)                   │
│  强制规则: maxPerFreq=1, URL去重, 作者去重                    │
└─────────────────────────────────────────────────────────────┘
```

##### 数据表

| 表名 | 用途 |
|------|------|
| `leads_pool` | 原始候选内容（pending/enriched/failed） |
| `content_reservoir` | 已分析的储备内容（pending/published） |
| `radar_items` | 最终发布内容 |

##### 核心规则

| 规则 | 说明 |
|------|------|
| **URL 唯一** | 同一 source_url 一天内不能重复发布 |
| **频段唯一** | 每日每频段最多 1 条 (`maxPerFreq: 1`) |
| **作者唯一** | 同一天同作者只发一条，防止单一视角主导 (v5.1.34+) |
| **频段同步** | 发布前从 `radar_items` 同步已用频段 |

##### 核心服务文件

| 文件 | 功能 |
|------|------|
| `leads-manager.js` | 候选池管理 + Lead 深挖 |
| `content-reservoir.js` | 储备池管理 + 发布逻辑 |
| `content-radar.js` | 统一扫描入口（dailyScan） |
| `multi-source-generator.js` | 配额计算 + 缺口分析 |

---

### 4.6 YouTube 公众反应数据采集

> **状态**：🚧 开发中 (2026-01-26 已完成代码，待验证)

#### 4.6.1 功能目标

采集 YouTube 视频的公众互动数据，用于：
1. **排行榜**：热度排行（观看量、点赞、评论）
2. **趋势分析**：观点热度变化追踪
3. **内容评估**：判断思想观点的公众接受度

#### 4.6.2 数据字段

| 字段 | 说明 |
|------|------|
| `video_id` | YouTube 视频 ID |
| `yt_view_count` | 观看量 |
| `yt_like_count` | 点赞数 |
| `yt_comment_count` | 评论数 |
| `yt_updated_at` | 数据更新时间 |

#### 4.6.3 API 端点

| 端点 | 方法 | 用途 |
|------|------|------|
| `/api/automation/update-youtube-engagement` | POST | 触发采集 |
| `/api/automation/youtube-engagement-stats` | GET | 获取统计 |
| `/api/automation/set-video-ids` | POST | 关联 video_id |

#### 4.6.4 调度规则（计划）

- 定时执行：**每日 2 次**（北京时间 06:00, 18:00）
- 触发条件：`video_id` 字段非空的内容项

---

## 五、内容发布规则

### 5.1 普通日（🔵 Regular Day）

| 项目 | 要求 |
|------|------|
| 每日数量 | 6-8 条 |
| **非视频（RSS/博客）** | **5-7 条（强制）** |
| **视频（YouTube）** | **≥1 条（强制）** |
| 频段分布 | 6 大领域各至少 1 条 |
| 正文字数 | ≥ 500 可见字符 |
| 视频时长 | ≥ 40 分钟 |
| 来源多样性 | 不同作者、不同媒体 |

> 📌 **v2.0 核心变化**：RSS/博客为主（P0/P1），YouTube 视频为补充（P2）

### 5.2 主题日（🔴 Theme Day）

**触发条件**：达沃斯、G20、APEC、联合国大会、CES、诺贝尔周等重大活动

| 项目 | 要求 |
|------|------|
| 每日数量 | **10-12 条** |
| 最低要求 | **10 条** |
| 频段限制 | 解除（不要求均衡覆盖，每频段不限） |
| 视频限制 | 解除（可全部为视频） |
| 视频时长 | ≥ 20 分钟 |
| **100% 主题聚焦** | 只收录主题活动现场内容 |
| **领袖资格** | 必须是各领域公认领袖 |
| **配置文件** | `backend/config/day-config.json` |
| **主题日 Banner** | 在今日页面顶部显示主题名称 |

### 5.3 内容质量要求（严格执行）

#### 5.3.1 字数要求

| 项目 | 要求 | 验证方式 |
|------|------|----------|
| 正文字数 | **≥ 500 可见字符** | `countVisibleChars()` 统一计数 |
| 标题长度 | 10-100 字 | 自动校验 |

> **可见字符计数**：排除换行符和多余空格，只计算实际显示的字符  
> 验证模块：`backend/utils/char-count.js` 和 `mobile/services/char-count.js`

#### 5.3.2 零重复规则

| 规则 | 说明 | 验证方式 |
|------|------|----------|
| URL 唯一 | 同一 source_url 不能出现两次 | 数据库唯一约束 |
| 视频ID 唯一 | 同一 YouTube 视频不能重复 | 提取 video_id 校验 |
| **作者唯一** | 同一天同作者只发一条 (v5.1.34+) | `publishedAuthors` Set |
| 标题去重 | 相似度 ≥ 80% 阻断 | 算法检测 + 人工确认 |

#### 5.3.3 来源信息规范（必填）

> 🆕 **v5.1.34 更新**：每条内容必须包含完整的来源信息，支持用户验证真实性

| 字段 | 必填 | 说明 | 示例 |
|------|------|------|------|
| `author_name` | ✅ | **真实人名**，禁止使用机构名或来源名 | `Adam Tooze` (非 "Google News") |
| `source` | ✅ | 发布场合、活动名称 + 时间 | `2026年1月28日 · Financial Times` |
| `source_url` | ✅ | 可访问的原文/视频链接 | `https://youtube.com/watch?v=xxx` |

**source 格式模板**：`YYYY年M月D日 · [媒体/会议名称]`

| 类型 | 格式示例 |
|------|----------|
| 论坛演讲 | `Davos WEF 2026 主题演讲, 2026年1月23日` |
| 访谈节目 | `Lex Fridman Podcast #420, 2026年1月15日` |
| 新闻采访 | `Bloomberg TV 专访, 2026年1月20日` |

**source_url 要求**：
- 必须可访问：链接必须能够打开
- 必须是原始来源：不接受二手转载链接
- 优先官方渠道：YouTube 官方频道 > 第三方上传

**禁止行为（零虚构容忍）**：

| 禁止 | 说明 |
|------|------|
| 虚构 URL | source_url 必须是真实可访问的链接 |
| 虚构作者 | author_name 必须是真实存在的人物 |
| 虚构日期 | 发布日期必须与原始内容一致 |
| 虚构引用 | 正文中的引用必须来自真实来源 |
| 编造来源 | 禁止编造不存在的文章/视频/书籍 |

#### 5.3.4 内容质量标准

| 标准 | 说明 |
|------|------|
| **结构解释** | 不是新闻摘要，而是对事实背后结构的解释 |
| **理论框架** | 必须呈现某种分析框架或思想模型 |
| **价值冲突** | 必须体现 A/B 两极的张力 |
| **命题对照** | 能与频段的核心问题形成对照 |

#### 5.3.5 频段匹配

| 规则 | 说明 |
|------|------|
| 频段相关性 | 内容必须与所选频段的核心问题相关 |
| 立场一致性 | stance (A/B) 必须与内容实际观点一致 |
| 禁止错配 | 技术内容不能放政治频段，反之亦然 |

### 5.4 质检清单（发布前必查）

- [ ] 正文 ≥ 700 字
- [ ] source_url 是真实有效链接
- [ ] 作者是真实人物
- [ ] URL 未重复（系统自动检查）
- [ ] 标题未重复（系统自动检查）
- [ ] 频段选择正确
- [ ] A/B 立场与内容一致
- [ ] 内容有结构解释，不是简单新闻摘要

---

## 六、功能需求

### 6.1 后端 API

| 功能 | 状态 |
|------|------|
| 雷达数据 CRUD | ✅ |
| 频段管理 | ✅ |
| TTI 更新 | ✅ |
| 用户收藏 | ✅ |
| 用户立场 | ✅ |
| 用户认证 | ✅ |

### 6.2 CMS 管理系统

| 功能 | 状态 |
|------|------|
| 内容列表（按日期分组） | ✅ |
| 添加/编辑/删除内容 | ✅ |
| 字数验证（≥700） | ⏳ 需更新 |
| 每日数量提示 | ✅ |
| 频段覆盖检查 | ✅ |
| 频段 TTI 管理 | ✅ |
| URL 重复检查 | ⏳ 需实现 |
| 标题相似度检查 | ⏳ 需实现 |

### 6.3 移动端 APP

| 功能 | 状态 |
|------|------|
| 今日雷达页面 | ✅ |
| 领域筛选器 | ✅ |
| 卡片展开/收起 | ✅ |
| 收藏功能 | ✅ |
| 立场表态（A/B） | ✅ |
| 张力指数页面（TTI 光谱） | ✅ |
| 历史记录页面 | ✅ |
| 个人中心 | ✅ |
| 离线缓存 | ✅ |
| 登录/注册 | ✅ |
| ~~下拉刷新~~ | ❌ 已取消 |

### 6.4 待开发功能

| 功能 | 优先级 |
|------|--------|
| 搜索功能 | P1 |
| 推送通知 | P2 |
| 分享功能 | P2 |
| 来源质量排名 | P2 |
| 人物热度追踪 | P2 |
| 评论系统 | P3 |

---

## 七、数据模型

### 7.1 频段表 (bands)

| 字段 | 说明 |
|------|------|
| id | 频段ID（T1, P1, H1, Φ1, R1, F1...） |
| domain | 领域 |
| core_question | 核心问题 |
| pole_a / pole_b | A/B 两极描述 |
| tti | 张力指数（0-100） |

### 7.2 雷达条目表 (radar_items)

| 字段 | 约束 |
|------|------|
| date | 发布日期 |
| band_id | 关联频段 |
| stance | A 或 B |
| title | 标题 |
| author_name / author_title | 作者信息 |
| source / source_url | 出处（**必须真实**） |
| content | 正文（**≥700字**） |
| tension_question / tension_a / tension_b | 张力信息 |

### 7.3 用户行为表 (user_actions)

| 字段 | 说明 |
|------|------|
| user_id | 用户标识 |
| item_id | 关联雷达条目 |
| action_type | like / stance |
| action_value | true / A / B |

---

## 八、运维约束

| 约束 | 说明 |
|------|------|
| 环境分离 | 本地/线上数据库**必须分离** |
| 部署前确认 | 必须确认当前连接的数据库环境 |
| 定时任务 | 必须有日志、失败通知、超时设置 |
| 网络请求 | 必须有 timeout(10s) 和重试(3次) |
| 密钥管理 | 禁止硬编码，使用环境变量 |

---

## 九、相关文档

| 文档 | 内容 |
|------|------|
| CLAUDE.md | AI 开发规则（强制遵守） |
| CONTENT_SOURCES.md | YouTube 频道、人物名单、出版物清单 |
| LOCAL_SETUP.md | 本地启动指南 |
| DEPLOY.md | 部署指南 |
| CHECKLIST.md | 测试清单 |

---

## 十、变更记录

| 日期 | 变更 |
|------|------|
| 2026-01-29 | v5.1.34 - ① AI JSON 容错 (safeParseAiJson 减少解析失败率) ② 作者去重 (同一天同作者只发一条) ③ 作者归属规范 (author_name 必须真实人名，source 必须含日期+场合) |
| 2026-01-28 | v4.2 - v5.1 双池管道架构：leads_pool → content_reservoir → radar_items，URL去重 + 频段同步 |
| 2026-01-28 | v4.2 - Bug修复：INSERT schema匹配、NaN bigint防护、maxPerFreq规则强制执行 |
| 2026-01-27 | v4.1 - P2 视频扫描机制：RSS fallback + YouTube API 配额优化（4.5.6 章节） |
| 2026-01-27 | v4.0 - 内容生成 v2.0 框架：P0/P1/P2 优先级体系、普通日非视频配额 5-7 + 视频≥1、频段覆盖强制 |
| 2026-01-26 | v3.4 - 新增 YouTube 公众反应数据采集需求 (4.5 章节) |
| 2026-01-26 | v3.3 - 新增来源信息规范 (source + source_url 必填要求) |
| 2026-01-25 | v3.1 - 增强质检规则（5.3-5.4），新增 CLAUDE.md |
| 2026-01-25 | v3.0 - 精简重构，正文≥700字，主题日15-20条，取消下拉刷新 |
| 2026-01-25 | v2.0 - 整合原始 PRD |

---

*本文件是思想雷达项目的唯一需求来源*
